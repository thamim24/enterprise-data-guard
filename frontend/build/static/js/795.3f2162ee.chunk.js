"use strict";(self.webpackChunkenterprise_data_guard_frontend=self.webpackChunkenterprise_data_guard_frontend||[]).push([[795],{795:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var r=s(43),a=s(213),l=s(579);const n=e=>{let{userDepartment:t,onUploadSuccess:s}=e;const[n,i]=(0,r.useState)([]),[d,o]=(0,r.useState)(t),[c,p]=(0,r.useState)(!1),[u,x]=(0,r.useState)({}),[h,m]=(0,r.useState)(""),[g,f]=(0,r.useState)(!1),j=(0,r.useRef)(null),y=10485760,v=(0,r.useMemo)(()=>[".txt",".pdf",".doc",".docx",".xlsx",".pptx",".jpg",".png"],[]),b=(0,r.useCallback)(e=>{const t=[];e.size>y&&t.push(`File "${e.name}" exceeds 10MB limit`);const s="."+e.name.split(".").pop().toLowerCase();return v.includes(s)||t.push(`File "${e.name}" has unsupported format. Allowed: ${v.join(", ")}`),t},[y,v]),S=(0,r.useCallback)(e=>{const t=Array.from(e),s=[],r=[];t.forEach(e=>{const t=b(e);if(0===t.length){n.some(t=>t.name===e.name&&t.size===e.size)?r.push(`File "${e.name}" is already selected`):s.push({file:e,id:Date.now()+Math.random(),name:e.name,size:e.size,type:e.type,status:"pending"})}else r.push(...t)}),s.length>0&&(i(e=>[...e,...s]),m("")),r.length>0&&m(r.join(". "))},[n,b]),w=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?f(!0):"dragleave"===e.type&&f(!1)},[]),k=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&S(e.dataTransfer.files)},[S]),z=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},D=async e=>{const t=new FormData;t.append("file",e.file),t.append("department",d);try{const s=localStorage.getItem("token");return{success:!0,data:(await a.A.post("http://localhost:8000/api/documents/upload",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${s}`},onUploadProgress:t=>{const s=Math.round(100*t.loaded/t.total);x(t=>({...t,[e.id]:s}))}})).data}}catch(l){var s,r;return{success:!1,error:(null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.detail)||"Upload failed"}}};return(0,l.jsxs)("div",{className:"upload-container",children:[(0,l.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0===n.length)return void m("Please select files to upload");p(!0),m("");const t=[];let r=0,a=0;i(e=>e.map(e=>({...e,status:"uploading"})));for(const s of n){const e=await D(s);e.success?(r++,i(e=>e.map(e=>e.id===s.id?{...e,status:"completed"}:e))):(a++,i(t=>t.map(t=>t.id===s.id?{...t,status:"error",error:e.error}:t))),t.push({file:s,result:e})}p(!1),r>0&&0===a?(m(`\u2705 Successfully uploaded ${r} file(s)!`),setTimeout(()=>{i(e=>e.filter(e=>"completed"!==e.status)),x({})},3e3)):m(r>0&&a>0?`\u26a0\ufe0f ${r} files uploaded successfully, ${a} failed`:"\u274c All uploads failed. Please check file requirements."),s&&r>0&&s()},children:[(0,l.jsxs)("div",{className:"form-group",style:{marginBottom:"20px"},children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"\ud83c\udfe2 Target Department:"}),(0,l.jsx)("select",{value:d,onChange:e=>o(e.target.value),style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"},required:!0,children:["HR","Finance","Legal","IT","Operations"].map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{className:"drag-drop-area "+(g?"active":""),onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:k,onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},style:{border:"2px dashed "+(g?"#007bff":"#ddd"),borderRadius:"8px",padding:"40px 20px",textAlign:"center",cursor:"pointer",backgroundColor:g?"#f0f8ff":"#f8f9fa",transition:"all 0.3s ease",marginBottom:"20px"},children:[(0,l.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:g?"\ud83d\udcc2":"\ud83d\udcc1"}),(0,l.jsx)("h3",{style:{margin:"0 0 8px 0",color:"#333"},children:g?"Drop files here!":"Drag & drop files here"}),(0,l.jsxs)("p",{style:{margin:"0",color:"#666",fontSize:"14px"},children:["or ",(0,l.jsx)("span",{style:{color:"#007bff",textDecoration:"underline"},children:"browse files"})]}),(0,l.jsxs)("p",{style:{margin:"8px 0 0 0",fontSize:"12px",color:"#888"},children:["Supported: ",v.join(", ")," \u2022 Max size: 10MB each"]})]}),(0,l.jsx)("input",{ref:j,type:"file",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&S(e.target.files)},accept:v.join(","),style:{display:"none"}}),n.length>0&&(0,l.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[(0,l.jsxs)("h4",{style:{margin:0},children:["\ud83d\udcce Selected Files (",n.length,")"]}),(0,l.jsx)("button",{type:"button",onClick:()=>{i([]),x({}),m(""),j.current&&(j.current.value="")},style:{background:"none",border:"1px solid #dc3545",color:"#dc3545",padding:"4px 8px",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\ud83d\uddd1\ufe0f Clear All"})]}),(0,l.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px"},children:n.map(e=>{return(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee",backgroundColor:"error"===e.status?"#fff5f5":"completed"===e.status?"#f0fff4":"white"},children:[(0,l.jsx)("span",{style:{fontSize:"20px",marginRight:"12px"},children:(t=e.name,{pdf:"\ud83d\udcc4",doc:"\ud83d\udcdd",docx:"\ud83d\udcdd",txt:"\ud83d\udcc4",xlsx:"\ud83d\udcca",xls:"\ud83d\udcca",pptx:"\ud83d\udcca",ppt:"\ud83d\udcca",jpg:"\ud83d\uddbc\ufe0f",jpeg:"\ud83d\uddbc\ufe0f",png:"\ud83d\uddbc\ufe0f",gif:"\ud83d\uddbc\ufe0f"}[t.split(".").pop().toLowerCase()]||"\ud83d\udcc1")}),(0,l.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,l.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name}),(0,l.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:z(e.size)}),"uploading"===e.status&&void 0!==u[e.id]&&(0,l.jsxs)("div",{style:{marginTop:"8px"},children:[(0,l.jsx)("div",{style:{width:"100%",height:"4px",backgroundColor:"#e0e0e0",borderRadius:"2px",overflow:"hidden"},children:(0,l.jsx)("div",{style:{width:`${u[e.id]}%`,height:"100%",backgroundColor:"#007bff",transition:"width 0.3s ease"}})}),(0,l.jsxs)("div",{style:{fontSize:"11px",color:"#666",marginTop:"2px"},children:[u[e.id],"% uploaded"]})]}),"error"===e.status&&(0,l.jsxs)("div",{style:{fontSize:"12px",color:"#dc3545",marginTop:"4px"},children:["\u274c ",e.error]})]}),(0,l.jsxs)("div",{style:{marginLeft:"12px",fontSize:"16px"},children:["pending"===e.status&&"\u23f3","uploading"===e.status&&"\u2b06\ufe0f","completed"===e.status&&"\u2705","error"===e.status&&"\u274c"]}),"uploading"!==e.status&&(0,l.jsx)("button",{type:"button",onClick:()=>{return t=e.id,i(e=>e.filter(e=>e.id!==t)),void x(e=>{const s={...e};return delete s[t],s});var t},style:{background:"none",border:"none",color:"#dc3545",cursor:"pointer",marginLeft:"8px",fontSize:"16px"},title:"Remove file",children:"\u2715"})]},e.id);var t})})]}),h&&(0,l.jsx)("div",{className:"alert "+(h.includes("\u2705")?"alert-success":h.includes("\u26a0\ufe0f")?"alert-warning":"alert-danger"),style:{marginBottom:"20px"},children:h}),(0,l.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(0,l.jsx)("button",{type:"submit",className:"btn btn-success",disabled:c||0===n.length,style:{padding:"12px 24px",fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{children:"\u23f3"}),"Uploading... (",n.filter(e=>"completed"===e.status).length,"/",n.length,")"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{children:"\ud83d\udce4"}),"Upload ",n.length," File",1!==n.length?"s":""]})}),n.length>0&&!c&&(0,l.jsxs)("div",{style:{fontSize:"14px",color:"#666"},children:["Total size: ",z(n.reduce((e,t)=>e+t.size,0))]})]})]}),(0,l.jsxs)("div",{style:{marginTop:"25px",padding:"15px",background:"#e9ecef",borderRadius:"6px",fontSize:"13px"},children:[(0,l.jsx)("h4",{style:{margin:"0 0 10px 0",color:"#495057"},children:"\ud83d\udccb Upload Guidelines"}),(0,l.jsxs)("ul",{style:{margin:0,paddingLeft:"18px",color:"#6c757d"},children:[(0,l.jsxs)("li",{children:["Supported formats: ",v.join(", ")]}),(0,l.jsx)("li",{children:"Maximum file size: 10MB per file"}),(0,l.jsx)("li",{children:"Multiple files can be uploaded simultaneously"}),(0,l.jsx)("li",{children:"Files are automatically scanned for security threats"}),(0,l.jsx)("li",{children:"Cross-department uploads require admin approval"}),(0,l.jsx)("li",{children:"All uploads are logged and monitored"})]})]})]})},i=e=>{let{user:t,onLogout:s}=e;const[i,d]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[p,u]=(0,r.useState)(""),x=async()=>{try{const e=localStorage.getItem("token"),t=await a.A.get("http://localhost:8000/api/documents/list",{headers:{Authorization:`Bearer ${e}`}});d(t.data.documents)}catch(p){u("Failed to fetch documents"),console.error(p)}finally{c(!1)}};(0,r.useEffect)(()=>{x()},[]);return o?(0,l.jsx)("div",{children:"Loading..."}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("nav",{className:"navbar",children:[(0,l.jsx)("h1",{children:"\ud83d\udcc1 User Dashboard"}),(0,l.jsxs)("div",{className:"user-info",children:[(0,l.jsxs)("span",{children:["\ud83d\udc64 ",t.username," (",t.department,")"]}),(0,l.jsx)("button",{className:"btn btn-danger",onClick:s,children:"Logout"})]})]}),(0,l.jsxs)("div",{className:"container",children:[p&&(0,l.jsx)("div",{className:"alert alert-danger",children:p}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"\ud83d\udce4 Upload Document"}),(0,l.jsx)(n,{userDepartment:t.department,onUploadSuccess:()=>{x()}})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("h3",{children:["\ud83d\udccb My Department Documents (",t.department,")"]}),0===i.length?(0,l.jsx)("p",{children:"No documents found in your department."}):(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Document Name"}),(0,l.jsx)("th",{children:"Department"}),(0,l.jsx)("th",{children:"Modified By"}),(0,l.jsx)("th",{children:"Last Updated"}),(0,l.jsx)("th",{children:"Actions"})]})}),(0,l.jsx)("tbody",{children:i.map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsxs)("td",{children:["\ud83d\udcc4 ",e.name]}),(0,l.jsx)("td",{children:e.department}),(0,l.jsx)("td",{children:e.modified_by_username||"System"}),(0,l.jsx)("td",{children:new Date(e.updated_at).toLocaleString()}),(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"btn",onClick:()=>(async(e,t)=>{try{const s=localStorage.getItem("token"),r=await a.A.get(`http://localhost:8000/api/documents/download/${e}`,{headers:{Authorization:`Bearer ${s}`},responseType:"blob"}),l=window.URL.createObjectURL(new Blob([r.data])),n=document.createElement("a");n.href=l,n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove()}catch(p){var s,r;alert((null===(s=p.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.detail)||"Download failed")}})(e.id,e.name),children:"Download"})})]},e.id))})]})]}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h3",{children:"\ud83d\udcca Quick Stats"}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px"},children:[(0,l.jsxs)("div",{style:{textAlign:"center",padding:"20px",background:"#e7f3ff",borderRadius:"8px"},children:[(0,l.jsx)("h2",{style:{margin:"0",color:"#0066cc"},children:i.length}),(0,l.jsx)("p",{style:{margin:"5px 0 0 0"},children:"Available Documents"})]}),(0,l.jsxs)("div",{style:{textAlign:"center",padding:"20px",background:"#f0f9e7",borderRadius:"8px"},children:[(0,l.jsx)("h2",{style:{margin:"0",color:"#28a745"},children:t.department}),(0,l.jsx)("p",{style:{margin:"5px 0 0 0"},children:"Your Department"})]})]})]})]})]})}}}]);
//# sourceMappingURL=795.3f2162ee.chunk.js.map