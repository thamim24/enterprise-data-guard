"use strict";(self.webpackChunkenterprise_data_guard_frontend=self.webpackChunkenterprise_data_guard_frontend||[]).push([[638],{638:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(43),l=s(213),n=s(579);const r=e=>{let{userDepartment:t,onUploadSuccess:s}=e;const[r,i]=(0,a.useState)([]),[d,o]=(0,a.useState)(t),[c,p]=(0,a.useState)(!1),[h,u]=(0,a.useState)({}),[m,x]=(0,a.useState)(""),[g,f]=(0,a.useState)(!1),j=(0,a.useRef)(null),y=10485760,v=(0,a.useMemo)(()=>[".txt",".pdf",".doc",".docx",".xlsx",".pptx",".jpg",".png"],[]),b=(0,a.useCallback)(e=>{const t=[];e.size>y&&t.push(`File "${e.name}" exceeds 10MB limit`);const s="."+e.name.split(".").pop().toLowerCase();return v.includes(s)||t.push(`File "${e.name}" has unsupported format. Allowed: ${v.join(", ")}`),t},[y,v]),w=(0,a.useCallback)(e=>{const t=Array.from(e),s=[],a=[];t.forEach(e=>{const t=b(e);if(0===t.length){r.some(t=>t.name===e.name&&t.size===e.size)?a.push(`File "${e.name}" is already selected`):s.push({file:e,id:Date.now()+Math.random(),name:e.name,size:e.size,type:e.type,status:"pending"})}else a.push(...t)}),s.length>0&&(i(e=>[...e,...s]),x("")),a.length>0&&x(a.join(". "))},[r,b]),S=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?f(!0):"dragleave"===e.type&&f(!1)},[]),N=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),f(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&w(e.dataTransfer.files)},[w]),D=e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},k=async e=>{const t=new FormData;t.append("file",e.file),t.append("department",d);try{const s=localStorage.getItem("token");return{success:!0,data:(await l.A.post("http://localhost:8000/api/documents/upload",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${s}`},onUploadProgress:t=>{const s=Math.round(100*t.loaded/t.total);u(t=>({...t,[e.id]:s}))}})).data}}catch(n){var s,a;return{success:!1,error:(null===(s=n.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.detail)||"Upload failed"}}};return(0,n.jsxs)("div",{className:"upload-container",children:[(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0===r.length)return void x("Please select files to upload");p(!0),x("");const t=[];let a=0,l=0;i(e=>e.map(e=>({...e,status:"uploading"})));for(const s of r){const e=await k(s);e.success?(a++,i(e=>e.map(e=>e.id===s.id?{...e,status:"completed"}:e))):(l++,i(t=>t.map(t=>t.id===s.id?{...t,status:"error",error:e.error}:t))),t.push({file:s,result:e})}p(!1),a>0&&0===l?(x(`\u2705 Successfully uploaded ${a} file(s)!`),setTimeout(()=>{i(e=>e.filter(e=>"completed"!==e.status)),u({})},3e3)):x(a>0&&l>0?`\u26a0\ufe0f ${a} files uploaded successfully, ${l} failed`:"\u274c All uploads failed. Please check file requirements."),s&&a>0&&s()},children:[(0,n.jsxs)("div",{className:"form-group",style:{marginBottom:"20px"},children:[(0,n.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"\ud83c\udfe2 Target Department:"}),(0,n.jsx)("select",{value:d,onChange:e=>o(e.target.value),style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px"},required:!0,children:["HR","Finance","Legal","IT","Operations"].map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)("div",{className:"drag-drop-area "+(g?"active":""),onDragEnter:S,onDragLeave:S,onDragOver:S,onDrop:N,onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},style:{border:"2px dashed "+(g?"#007bff":"#ddd"),borderRadius:"8px",padding:"40px 20px",textAlign:"center",cursor:"pointer",backgroundColor:g?"#f0f8ff":"#f8f9fa",transition:"all 0.3s ease",marginBottom:"20px"},children:[(0,n.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:g?"\ud83d\udcc2":"\ud83d\udcc1"}),(0,n.jsx)("h3",{style:{margin:"0 0 8px 0",color:"#333"},children:g?"Drop files here!":"Drag & drop files here"}),(0,n.jsxs)("p",{style:{margin:"0",color:"#666",fontSize:"14px"},children:["or ",(0,n.jsx)("span",{style:{color:"#007bff",textDecoration:"underline"},children:"browse files"})]}),(0,n.jsxs)("p",{style:{margin:"8px 0 0 0",fontSize:"12px",color:"#888"},children:["Supported: ",v.join(", ")," \u2022 Max size: 10MB each"]})]}),(0,n.jsx)("input",{ref:j,type:"file",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&w(e.target.files)},accept:v.join(","),style:{display:"none"}}),r.length>0&&(0,n.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[(0,n.jsxs)("h4",{style:{margin:0},children:["\ud83d\udcce Selected Files (",r.length,")"]}),(0,n.jsx)("button",{type:"button",onClick:()=>{i([]),u({}),x(""),j.current&&(j.current.value="")},style:{background:"none",border:"1px solid #dc3545",color:"#dc3545",padding:"4px 8px",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\ud83d\uddd1\ufe0f Clear All"})]}),(0,n.jsx)("div",{style:{maxHeight:"300px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px"},children:r.map(e=>{return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #eee",backgroundColor:"error"===e.status?"#fff5f5":"completed"===e.status?"#f0fff4":"white"},children:[(0,n.jsx)("span",{style:{fontSize:"20px",marginRight:"12px"},children:(t=e.name,{pdf:"\ud83d\udcc4",doc:"\ud83d\udcdd",docx:"\ud83d\udcdd",txt:"\ud83d\udcc4",xlsx:"\ud83d\udcca",xls:"\ud83d\udcca",pptx:"\ud83d\udcca",ppt:"\ud83d\udcca",jpg:"\ud83d\uddbc\ufe0f",jpeg:"\ud83d\uddbc\ufe0f",png:"\ud83d\uddbc\ufe0f",gif:"\ud83d\uddbc\ufe0f"}[t.split(".").pop().toLowerCase()]||"\ud83d\udcc1")}),(0,n.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,n.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#666"},children:D(e.size)}),"uploading"===e.status&&void 0!==h[e.id]&&(0,n.jsxs)("div",{style:{marginTop:"8px"},children:[(0,n.jsx)("div",{style:{width:"100%",height:"4px",backgroundColor:"#e0e0e0",borderRadius:"2px",overflow:"hidden"},children:(0,n.jsx)("div",{style:{width:`${h[e.id]}%`,height:"100%",backgroundColor:"#007bff",transition:"width 0.3s ease"}})}),(0,n.jsxs)("div",{style:{fontSize:"11px",color:"#666",marginTop:"2px"},children:[h[e.id],"% uploaded"]})]}),"error"===e.status&&(0,n.jsxs)("div",{style:{fontSize:"12px",color:"#dc3545",marginTop:"4px"},children:["\u274c ",e.error]})]}),(0,n.jsxs)("div",{style:{marginLeft:"12px",fontSize:"16px"},children:["pending"===e.status&&"\u23f3","uploading"===e.status&&"\u2b06\ufe0f","completed"===e.status&&"\u2705","error"===e.status&&"\u274c"]}),"uploading"!==e.status&&(0,n.jsx)("button",{type:"button",onClick:()=>{return t=e.id,i(e=>e.filter(e=>e.id!==t)),void u(e=>{const s={...e};return delete s[t],s});var t},style:{background:"none",border:"none",color:"#dc3545",cursor:"pointer",marginLeft:"8px",fontSize:"16px"},title:"Remove file",children:"\u2715"})]},e.id);var t})})]}),m&&(0,n.jsx)("div",{className:"alert "+(m.includes("\u2705")?"alert-success":m.includes("\u26a0\ufe0f")?"alert-warning":"alert-danger"),style:{marginBottom:"20px"},children:m}),(0,n.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(0,n.jsx)("button",{type:"submit",className:"btn btn-success",disabled:c||0===r.length,style:{padding:"12px 24px",fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"\u23f3"}),"Uploading... (",r.filter(e=>"completed"===e.status).length,"/",r.length,")"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"\ud83d\udce4"}),"Upload ",r.length," File",1!==r.length?"s":""]})}),r.length>0&&!c&&(0,n.jsxs)("div",{style:{fontSize:"14px",color:"#666"},children:["Total size: ",D(r.reduce((e,t)=>e+t.size,0))]})]})]}),(0,n.jsxs)("div",{style:{marginTop:"25px",padding:"15px",background:"#e9ecef",borderRadius:"6px",fontSize:"13px"},children:[(0,n.jsx)("h4",{style:{margin:"0 0 10px 0",color:"#495057"},children:"\ud83d\udccb Upload Guidelines"}),(0,n.jsxs)("ul",{style:{margin:0,paddingLeft:"18px",color:"#6c757d"},children:[(0,n.jsxs)("li",{children:["Supported formats: ",v.join(", ")]}),(0,n.jsx)("li",{children:"Maximum file size: 10MB per file"}),(0,n.jsx)("li",{children:"Multiple files can be uploaded simultaneously"}),(0,n.jsx)("li",{children:"Files are automatically scanned for security threats"}),(0,n.jsx)("li",{children:"Cross-department uploads require admin approval"}),(0,n.jsx)("li",{children:"All uploads are logged and monitored"})]})]})]})};s(767);const i=e=>{let{user:t,onLogout:s}=e;const[i,d]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[p,h]=(0,a.useState)(""),u=async()=>{try{const e=localStorage.getItem("token"),t=await l.A.get("http://localhost:8000/api/documents/list",{headers:{Authorization:`Bearer ${e}`}});d(t.data.documents)}catch(p){h("Failed to fetch documents"),console.error(p)}finally{c(!1)}};(0,a.useEffect)(()=>{u()},[]);const m=async(e,t)=>{try{const s=localStorage.getItem("token"),a=await l.A.get(`http://localhost:8000/api/documents/download/${e}`,{headers:{Authorization:`Bearer ${s}`},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([a.data])),r=document.createElement("a");r.href=n,r.setAttribute("download",t),document.body.appendChild(r),r.click(),r.remove()}catch(p){var s,a;alert((null===(s=p.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.detail)||"Download failed")}};return o?(0,n.jsx)("div",{className:"loading",children:"Loading dashboard"}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("nav",{className:"navbar",children:[(0,n.jsx)("h1",{children:"Document Management Portal"}),(0,n.jsxs)("div",{className:"user-info",children:[(0,n.jsxs)("span",{children:[t.username," (",t.department,")"]}),(0,n.jsx)("button",{className:"btn btn-danger",onClick:s,children:"Logout"})]})]}),(0,n.jsxs)("div",{className:"container",children:[p&&(0,n.jsx)("div",{className:"alert alert-danger",children:p}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{children:"Upload Document"}),(0,n.jsx)(r,{userDepartment:t.department,onUploadSuccess:()=>{u()}})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("h3",{children:["My Department Documents (",t.department,")"]}),0===i.length?(0,n.jsx)("div",{className:"alert alert-info",children:"No documents found in your department."}):(0,n.jsxs)("table",{className:"table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Document Name"}),(0,n.jsx)("th",{children:"Department"}),(0,n.jsx)("th",{children:"Uploaded By"}),(0,n.jsx)("th",{children:"Last Updated"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:i.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.name}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:`dept-badge dept-${e.department.toLowerCase()}`,children:e.department})}),(0,n.jsx)("td",{children:e.modified_by_username||"System"}),(0,n.jsx)("td",{children:new Date(e.updated_at).toLocaleString()}),(0,n.jsxs)("td",{children:[(0,n.jsx)("button",{className:"btn btn-primary btn-small",onClick:()=>m(e.id,e.name),style:{marginRight:"8px"},children:"Download"}),("admin"===t.role||e.modified_by_username===t.username)&&(0,n.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>(async(e,t)=>{if(window.confirm(`Are you sure you want to delete "${t}"?`))try{const t=localStorage.getItem("token");await l.A.delete(`http://localhost:8000/api/documents/delete/${e}`,{headers:{Authorization:`Bearer ${t}`}}),alert("Document deleted successfully"),u()}catch(p){var s,a;alert((null===(s=p.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.detail)||"Delete failed")}})(e.id,e.name),children:"Delete"})]})]},e.id))})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{children:"Quick Statistics"}),(0,n.jsxs)("div",{className:"metrics-grid",style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"4.5rem",marginBottom:"2rem"},children:[(0,n.jsxs)("div",{className:"metric-card info",children:[(0,n.jsx)("h3",{children:"Available Documents"}),(0,n.jsx)("div",{className:"metric-value",children:i.length}),(0,n.jsx)("div",{className:"metric-label",children:"In your department"})]}),(0,n.jsxs)("div",{className:"metric-card success",children:[(0,n.jsx)("h3",{children:"Your Department"}),(0,n.jsx)("div",{className:"metric-value",style:{fontSize:"2.4rem"},children:t.department}),(0,n.jsx)("div",{className:"metric-label",children:"Access level"})]}),(0,n.jsxs)("div",{className:"metric-card neutral",children:[(0,n.jsx)("h3",{children:"Recent Activity"}),(0,n.jsx)("div",{className:"metric-value",children:i.filter(e=>{const t=new Date(e.updated_at),s=new Date,a=Math.abs(s-t);return Math.ceil(a/864e5)<=7}).length}),(0,n.jsx)("div",{className:"metric-label",children:"Updated this week"})]})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{children:"Recent Documents"}),i.length>0?(0,n.jsx)("div",{className:"content-grid",children:i.slice(0,6).map(e=>(0,n.jsxs)("div",{className:"summary-section",children:[(0,n.jsx)("h4",{children:e.name}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Department:"})," ",e.department]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Last Modified:"})," ",new Date(e.updated_at).toLocaleDateString()]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Uploaded By:"})," ",e.modified_by_username||"System"]}),(0,n.jsx)("button",{className:"btn btn-primary btn-small mt-2",onClick:()=>m(e.id,e.name),children:"Download"})]},e.id))}):(0,n.jsx)("div",{className:"alert alert-info",children:"No recent documents to display."})]})]})]})}},767:()=>{}}]);
//# sourceMappingURL=638.155ca17a.chunk.js.map